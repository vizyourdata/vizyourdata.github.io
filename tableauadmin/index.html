<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <link rel="preconnect" href="https://fonts.gstatic.com">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <!--FONTS fonts.google.com-->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300&family=Ubuntu:wght@500&display=swap" rel="stylesheet">
    
    <!--LOCAL Links-->
    <link rel="stylesheet" type="text/css" href="css/styles.css" >
    <title>Tableau Admin</title>
  </head>
  <body>
    

    <nav class='navbar navbar-expand-sm navbar-dark' style="background-color: #e68d27;">
        <a class='navbar-brand' href="index.html">Tableau Admin</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div id='navbarSupportedContent' class='collapse navbar-collapse'>
            <ul class='navbar-nav ml-auto'>
                <li class='nav-item'>
                <a class='nav-link' href="index.html">Contact</a> 
                </li>
                <li class='nav-item'>
                    <a class='nav-link' href="">Pricing</a> 
                </li>
                <li class='nav-item'>
                    <a class='nav-link' href="">Product</a> 
                </li>
            </ul>
        </div>
    </nav>
    <div class="container-fluid" id='main'>
        <div class='row'>
            <div class='col-lg-12'>
                <h1>Become an Intentional Admin With Us</h1>
            </div>
        </div>
        <!-- <div class='row'>
            <div class='col-lg-4'>
                <button type="button" class="btn btn-dark btn-lg btn-block">Block level button</button>
            </div>
        </div> -->
<p></p>

              <div class="collapse" id="collapseExample">
                <div class="card card-body">
                  Anim pariatur cliche reprehenderit, enim eiusmod anderson cred nesciunt sapiente ea proident.
                </div>
              </div>
              <p></p>
              <div class="btn-group btn-group-toggle" data-toggle="buttons">
                    <a class="btn btn-dark active" data-toggle="collapse" href="#collapsePublish" role="button" aria-expanded="false" aria-controls="collapseExample"> Publish </a>
                    <a class="btn btn-dark active" data-toggle="collapse" href="#collapseUsers" role="button" aria-expanded="false" aria-controls="collapseExample"> Users </a>
                    <a class="btn btn-dark active" data-toggle="collapse" href="#collapseMonitor" role="button" aria-expanded="false" aria-controls="collapseExample"> Monitor </a>
                    <a class="btn btn-dark active" data-toggle="collapse" href="#collapseOptimize" role="button" aria-expanded="false" aria-controls="collapseExample"> Optimize </a>            
                    <a class="btn btn-dark active" data-toggle="collapse" href="#collapseSettings" role="button" aria-expanded="false" aria-controls="collapseExample"> Settings </a> 
            </div>

      
      
      
      
              <!--********************PUBLISH*********************************--> 
              <div class="collapse" id="collapsePublish">
                <div class="card card-body openedCard">
                  <h4>Select Sites</h4>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="inlineCheckbox1" value="option1">
                    <label class="form-check-label" for="inlineCheckbox1">DEFAULT</label>
                  </div>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="inlineCheckbox2" value="option2">
                    <label class="form-check-label" for="inlineCheckbox2">CONN0122</label>
                  </div>
                  <p></p>
                  <h4>Select File</h4>
                  <div class="input-group mb-3 col-lg-4">
                    <div class="custom-file">
                      <input type="file" class="custom-file-input" id="inputGroupFile01" aria-describedby="inputGroupFileAddon01">
                      <label class="custom-file-label" for="inputGroupFile01"></label>
                    </div>
                  </div>
                  <p></p>
                  <h4>Tabs</h4>
                  <div class="input-group mb-3">
                    <legend>Hide or delete any tabs you will not want visible on your published dashboard.</legend>    
                  </div>
                  <h4>Datasource Credentials</h4>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio1" value="option1">
                    <label class="form-check-label" for="inlineRadio1">Embedded</label>
                  </div>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio2" value="option2">
                    <label class="form-check-label" for="inlineRadio2">Prompt</label>
                  </div>
                </div>
              </div>
              <!--********************/PUBLISH*********************************--> 

              <div class="collapse" id="collapseUsers">
                <div class="card card-body openedCard">
                  Here is the input area for Users
                </div>
              </div>
              <div class="collapse" id="collapseMonitor">
                <div class="card card-body openedCard">
                  Monitor
                </div>
              </div>
              <div class="collapse" id="collapseOptimize">
                <div class="card card-body openedCard">
                  Optimize
                </div>
              </div>
              <div class="uncollapse" id="collapseSettings">
                <div class="card card-body openedCard">
                  <div class='row'>
                    <form>
                      <div class="form-group">
                        <label for="login_url">Tableau Login URL</label>
                        <input type="url" class="form-control" id="tableau_url" value = "http://52.12.179.215" placeholder="Tableau Server URL">
                        
                        <label for="PATName">Personal Access Token Name</label>
                        <input class="form-control" id="PATName" value="'ubuntu'" placeholder="ubuntu">
                        
                        <label for="PAT">Personal Access Token</label>
                        <input class="form-control" id="PAT" value="'6xDa2+C8Q+CZ3EKci1HgtQ==:ZSZEkHUlGXa17m3ltdhUkJZo7jb0Srdo'" placeholder="6xDa2+C8Q+CZ3EKci1HgtQ==:ZSZEkHUlGXa17m3ltdhUkJZo7jb0Srdo">
                      </div>
                      <!-- //------button -->
                      <div class='row'>
                        <div class='col-lg-4'>
                          <button type="button" onclick="assign_var()" class="btn btn-dark btn-lg btn-block">Authentication</button>
                          <!-- <button type="button" onclick="post_signin()" class="btn btn-dark btn-lg btn-block">Authenticate</button> -->
                        </div>
                      </div>
                      <input class="col-lg-4 form-control" id="save_token">
                    
                    </form>
                  </div>
                    

                </div>
                
              </div>
    </div>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script>
console.log('save token')
//var session_token
//var session_site_id
//var session_user_id

function assign_var(){
  var tableau_url = document.getElementById("tableau_url").value + "/api/3.9/auth/signin"
  var PAT_Name = document.getElementById("PATName").value
  var PAT = document.getElementById("PAT").value
  var raw = "<tsRequest>\r\n	<credentials\r\n	  personalAccessTokenName=" +PAT_Name+ " personalAccessTokenSecret=" +PAT+ ">\r\n  		<site contentUrl=\"javascript\" />\r\n	</credentials>\r\n</tsRequest>";
  //console.log(raw)
  post_signin(raw,tableau_url);
}

function post_signin(raw,tableau_url) {
  var myHeaders = new Headers();
  //myHeaders.append("Content-Security-Policy", "upgrade-insecure-requests");
  myHeaders.append("Content-Type", "text/plain");
  myHeaders.append("Accept", "application/json");

  //var raw = "<tsRequest>\r\n	<credentials\r\n	  personalAccessTokenName=\"ubuntu\" personalAccessTokenSecret=\"6xDa2+C8Q+CZ3EKci1HgtQ==:ZSZEkHUlGXa17m3ltdhUkJZo7jb0Srdo\" >\r\n  		<site contentUrl=\"javascript\" />\r\n	</credentials>\r\n</tsRequest>";
  //console.log(raw)
  var requestOptions = {
    method: 'POST',
    headers: myHeaders,
    body: raw,
    redirect: 'follow'
  };

  // fetch("http://52.12.179.215/api/3.9/auth/signin", requestOptions)
  fetch(tableau_url, requestOptions)
    .then(response => response.json())
    .then(result => {
      console.log(result)
      //console.log(result.credentials.token)
      //console.log(result.credentials.site.id)
      var session_token = result.credentials.token
      var session_site_id = result.credentials.site.id
      var session_user_id = result.credentials.user.id
      document.getElementById("save_token").value = session_token
      return session_token, session_site_id, session_user_id
    })
    .catch(error => console.log('error', error));

  // let response = await fetch(url, options); // resolves with response headers
  // let result = await response.text(); // read body as json
  // console.log(text.slice(0, 80) + '...');
  //console.log(session_token, session_site_id, session_user_id)
} 
console.log(session_token, session_site_id, session_user_id)

</script>



    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  </body>
</html>
